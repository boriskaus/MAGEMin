<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAGEMin.c &mdash; MAGEMin 2022 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/2022_MAGEMin_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">In development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../news.html">Seismic velocity calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stp.html">Linux-based system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stp/Linux.html">External libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stp/Linux.html#magemin">MAGEMin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stp.html#macos-system">macOS system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stp/macOS.html">External libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stp/macOS.html#magemin">MAGEMin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stp.html#optional-developers">Optional (developers)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stp/Dev.html">Python libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stp/Dev.html#c-tools">C tools</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Methods and examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../man.html">Thermodynamic problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../man/Thermo.html">Problem definition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../man/Thermo.html#total-gibbs-energy">1. Total Gibbs energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../man/Thermo.html#gibbs-duhem-constraint">2. Gibbs-Duhem constraint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../man/Thermo.html#mass-constraint">3. Mass constraint</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../man/Thermo.html#minimization-approach">Minimization approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Thermo.html#algorithm-demonstration">Algorithm demonstration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../man.html#phase-diagrams">Phase diagrams</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html">Examples of phase diagrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#peridotite-klb1">Peridotite (KLB1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#pyroxenite-mixg1">Pyroxenite (MIXG1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#basalt-re46">Basalt (RE46)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#basalt-nmorb">Basalt (NMORB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#hydrous-basalt">Hydrous basalt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../man/Examples.html#tonalite-101">Tonalite 101</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cookbook:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ckbk.html">Command line minimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/Commands.html">List of arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/Commands.html#single-point-calculation">Single point calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/Commands.html#multiple-points-calculation">Multiple points calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/Commands.html#multiple-points-in-parallel">Multiple points in parallel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ckbk.html#data-output">Data output</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/out_struct.html">As a nested structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ckbk.html#pseudosection-generator">Pseudosection generator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/gui.html">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ckbk/gui.html#klb-1-pseudosection-tutorial">KLB-1 Pseudosection tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#sarting-gui">Sarting GUI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#set-p-t-conditions">Set P-T conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#mesh-refinement-and-computation-options">Mesh refinement and computation options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#choose-bulk-rock-composition">Choose bulk-rock composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#compute-pseudosection">Compute pseudosection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#refine-pseudosection">Refine pseudosection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#change-displayed-field">Change displayed field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#display-stable-phases-labels">Display stable phases labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ckbk/gui.html#save-pseudosection-data">Save pseudosection data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Firewall warning (Apple M1)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers section:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev.html">Add database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/Dev.html">Analytical formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/Dev.html#generate-pseudocompounds">Generate pseudocompounds</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Source code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../src.html">Main algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/MAGEMin.html">MAGEMin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/MAGEMin.html#mineral-assemblage-gibbs-energy-minimization">Mineral Assemblage Gibbs Energy Minimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/simplex_levelling.html">Simplex levelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/PGE_function.html">PGE_function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/phase_update_function.html">phase_update_function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/phase_update_function.html#pp-ss-flags">PP &amp; SS_flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/dump_function.html">dump_function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src.html#pure-phases-functions">Pure phases functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/gem_function.html">gem_function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/pp_min_function.html">pp_min_function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/pp_min_function.html#pure-phase-minimization-function">Pure phase minimization function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src.html#solution-phases-functions">Solution phases functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/gss_init_function.html">gss_init_function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/gss_init_function.html#pp-ss-flags">PP &amp; SS_flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/gss_function.html">gss_function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/ss_min_function.html">ss_min_function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/NLopt_opt_function.html">NLopt_opt_function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/objective_functions.html">objective_functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src.html#toolkit">Toolkit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/toolkit.html">toolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/io_function.html">io_function</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MAGEMin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>MAGEMin.c</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MAGEMin.c</h1><div class="highlight"><pre>
<span></span><span class="cm">/**</span>
<span class="cm">Mineral Assemblage Gibbs Energy Minimization		  </span>
<span class="cm">--------------------------------------------</span>

<span class="cm">Contributors: </span>

<span class="cm">- Main developers: Riel N., Kaus. B.</span>
<span class="cm">- Database translation and debugging: Green E., Berlie N., and Rummel L. </span>
<span class="cm">     </span>
<span class="cm">Contacts: nriel[at]uni-mainz.de, kaus[at]uni-mainz.de 		 </span>
<span class="cm">                                                                                                  </span>
<span class="cm">MAGEMin is written as a parallel C library callable from any petrological/geodynamic tool. For a given set of pressure, temperature and bulk-rock composition MAGEMin uses a combination of linear programming, extended Partitioning Gibbs free Energy and gradient-based local minimization to compute the most stable mineral assemblage     </span>
<span class="cm">      </span>
<span class="cm">Available thermodynamic dataset                       </span>
<span class="cm">================================</span>
<span class="cm"> </span>
<span class="cm">Igneous thermodynamic dataset</span>
<span class="cm">*****************************</span>
<span class="cm">                    </span>
<span class="cm">- Holland et al., 2018 (see http://hpxeosandthermocalc.org)</span>
<span class="cm">- K2O-Na2O-CaO-FeO-MgO-Al2O3-SiO2-H2O-TiO2-O-Cr2O3 chemical system</span>
<span class="cm">- Equations of state for</span>
<span class="cm">	- Pure stoichiometric phases quartz (q), cristobalite (crst), tridymite (trd), coesite (coe), stishovite (stv), kyanite (ky), sillimanite (sill), andalusite (and), rutile (ru) and sphene (sph). </span>
<span class="cm">	- Solution phases spinel (spn), biotite (bi), cordierite (cd), clinopyroxene (cpx), orthopyroxene (opx), epidote (ep), garnet (g), hornblende (hb), ilmenite (ilm), silicate melt (liq), muscovite (mu), olivine (ol), ternary feldspar (pl4T), and aqueous fluid (fl).</span>
<span class="cm">                                                    </span>
<span class="cm">Imported libraries                       </span>
<span class="cm">==================</span>

<span class="cm">- LAPACKE (C version of LAPACK)                         </span>
<span class="cm">- NLopt  (https://nlopt.readthedocs.io/)                </span>
<span class="cm">- uthash (https://troydhanson.github.io/uthash/)        </span>
<span class="cm">- ketopt (https://github.com/attractivechaos/klib/blob/master/ketopt.h) </span>
<span class="cm">   </span>
<span class="cm"> */</span><span class="w"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;complex.h&gt;</span><span class="c1"> </span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;uthash.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ketopt.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nlopt.h&quot;</span><span class="c1">                  // requires specifying this in the makefile</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;mpi.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Endmembers_tc-ds634.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;toolkit.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;io_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gem_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gss_init_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gss_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;objective_functions.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NLopt_opt_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;simplex_levelling.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Initialize.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ss_min_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pp_min_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dump_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;PGE_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;phase_update_function.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;MAGEMin.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;simplex_levelling.h&quot;</span><span class="cp"></span>

<div class="viewcode-block" id="c.n_em_db"><span class="cp">#define n_em_db 291</span></div>

<div class="viewcode-block" id="c.main"><span class="cm">/** </span>
<span class="cm">  Main routine</span>
<span class="cm">*/</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="w">		</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span>
<span class="w">				</span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="w"></span>
<span class="p">){</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> 	</span><span class="n">rank</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">MPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* call the main MAGEMin routine */</span><span class="w"></span>
<span class="w">	</span><span class="n">runMAGEMin</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span>
<span class="w">	</span><span class="n">MPI_Finalize</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.runMAGEMin"><span class="cm">/** </span>
<span class="cm">  call MAGEMin</span>
<span class="cm">*/</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">runMAGEMin</span><span class="p">(</span><span class="w">			</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span>
<span class="w">						</span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="w"></span>
<span class="p">){</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">numprocs</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">EM_database</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">time_taken</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="n">Databases</span><span class="w"> </span><span class="n">DB</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Select the endmember database */</span><span class="w"></span>
<span class="w">   	</span><span class="n">EM_database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_tc_ds634_</span><span class="p">;</span><span class="w"></span>
<span class="w">   	</span>
<span class="w">	</span><span class="kt">clock_t</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="n">u</span><span class="p">;</span><span class="w"> </span>
<span class="w">	</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">numprocs</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* initialize global structure to store shared variables (e.g. Gamma, SS and PP list, ...) */</span><span class="w"></span>
<span class="w">	</span><span class="n">global_variable</span><span class="w"> </span><span class="n">gv</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_variable_init</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Allocate both pure and solid-solution databases */</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitializeDatabases</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span><span class="n">EM_database</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/** Declare bulk info structure */</span><span class="w"></span>
<span class="w">	</span><span class="k">struct</span> <span class="nc">bulk_info</span><span class="w"> </span><span class="n">z_b</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Default conditions */</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">bulk_rock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="w"> </span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"> </span>
<span class="w">	</span><span class="kt">double</span><span class="w"> 	</span><span class="n">Pres</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> 	</span><span class="n">Temp</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">double</span><span class="w"> 	</span><span class="n">P</span><span class="w"> 			</span><span class="o">=</span><span class="w">  </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> 	</span><span class="n">T</span><span class="w"> 			</span><span class="o">=</span><span class="w">  </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">int</span><span class="w"> 	</span><span class="n">test</span><span class="w"> 		</span><span class="o">=</span><span class="w">  </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> 	</span><span class="n">Verb</span><span class="w"> 		</span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">     </span><span class="n">Mode</span><span class="w"> 		</span><span class="o">=</span><span class="w">  </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">     </span><span class="n">n_points</span><span class="w"> 	</span><span class="o">=</span><span class="w">  </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">int</span><span class="w"> 	</span><span class="n">maxeval</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">		</span><span class="n">get_version</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">double</span><span class="w">	</span><span class="n">Gam</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span><span class="w">  </span><span class="n">Bulk</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span><span class="w"> </span><span class="n">InitEM_Prop</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="kt">char</span><span class="w">    </span><span class="n">File</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span><span class="w"> </span><span class="n">Phase</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** </span>
<span class="cm">	Read command-line arguments and set default parameters</span>
<span class="cm">	*/</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadCommandLineOptions</span><span class="p">(</span><span class="w">	 </span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">									 </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span>
<span class="w">									 </span><span class="n">argv</span><span class="p">,</span><span class="w">  </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">Mode</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">Verb</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">test</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">n_points</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">Pres</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">Temp</span><span class="p">,</span><span class="w"></span>
<span class="w">									 </span><span class="n">Bulk</span><span class="p">,</span><span class="w"> </span>
<span class="w">									 </span><span class="n">Gam</span><span class="p">,</span><span class="w"> </span>
<span class="w">									 </span><span class="n">gv</span><span class="p">.</span><span class="n">init_prop</span><span class="p">,</span><span class="w"> </span>
<span class="w">									 </span><span class="n">File</span><span class="p">,</span><span class="w"> </span>
<span class="w">									 </span><span class="n">Phase</span><span class="p">,</span><span class="w"> </span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">maxeval</span><span class="p">,</span><span class="w"></span>
<span class="w">									</span><span class="o">&amp;</span><span class="n">get_version</span><span class="w">			</span><span class="p">);</span><span class="w"> </span>
<span class="w">									</span>

<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="n">Verb</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">Mode</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="n">Mode</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxeval</span><span class="o">&gt;</span><span class="mi">-1</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">gv</span><span class="p">.</span><span class="n">maxeval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxeval</span><span class="p">;</span><span class="w">   </span><span class="c1">// otherwise we use default. Note that 0 = no limit</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* initial dumping logs and output */</span><span class="w"></span>
<span class="w">	</span><span class="n">dump_init</span><span class="p">(</span><span class="n">gv</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">){</span><span class="w"></span>
<span class="w">    	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Running MAGEMin %5s on %d cores {</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">numprocs</span><span class="p">);</span><span class="w"></span>
<span class="w">    	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;═══════════════════════════════════</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**              READ INPUT FILE FOR MULTIPLE P-T CONDITIONS, IF IT EXISTS             **/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* 	allocate space to store input data, P,T,X, gam, x-eos etc. */</span><span class="w"></span>
<span class="w">	</span><span class="n">io_data</span><span class="w"> </span><span class="n">input_data</span><span class="p">[</span><span class="n">n_points</span><span class="p">];</span><span class="w"> </span>

<span class="w">	</span><span class="cm">/* get data from input file */</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="w"> </span><span class="n">File</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">	</span>
<span class="w">		</span><span class="n">read_in_data</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span><span class="n">input_data</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">,</span><span class="w"> </span><span class="n">n_points</span><span class="p">);</span><span class="w">			</span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**                       DEFINE SOME TEST BULK-ROCK COMPOSITIONS                      **/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* get bulk rock composition parsed from args */</span><span class="w"></span>
<span class="w">	</span><span class="n">get_bulk</span><span class="p">(</span><span class="w">		</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">test</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="w"> 						</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Override P,T &amp; bulk with command-line options, if there is no file parsed: */</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pres</span><span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">){</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pres</span><span class="w"> 					</span><span class="p">;}</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Temp</span><span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">){</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">273.15</span><span class="w">			</span><span class="p">;}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Bulk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"> </span><span class="n">bulk_rock</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bulk</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/** Normalize composition to sum to 1. 			*/</span><span class="w"></span>
<span class="w">	</span><span class="n">norm_array</span><span class="p">(</span><span class="w">		</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="w">						</span><span class="p">);</span><span class="w">						</span>
<span class="w">								</span>
<span class="w">	</span><span class="cm">/** Get zeros in bulk P and T 					*/</span><span class="w">				</span>
<span class="w">	</span><span class="n">z_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros_in_bulk</span><span class="p">(</span><span class="w">	</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span>
<span class="w">							</span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">							</span><span class="n">T</span><span class="w">						</span><span class="p">);</span><span class="w">									</span>

<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/**                               LAUNCH MINIMIZATION ROUTINE                          **/</span><span class="w"></span>
<span class="w">	</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sgleP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">sgleP</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_points</span><span class="p">;</span><span class="w"> </span><span class="n">sgleP</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">Mode</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">sgleP</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">numprocs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">rank</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w">   	</span><span class="cm">/** this ensures that, in parallel, not every point is computed by every processor (instead only every numprocs point). Only applied to Mode==0 */</span><span class="w"></span>

<span class="w">		</span><span class="n">t</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span><span class="w">								</span><span class="cm">/** reset loop timer 				*/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="p">.</span><span class="n">BR_norm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> 									</span><span class="cm">/** reset bulk rock norm 			*/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="p">.</span><span class="n">global_ite</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">              						</span><span class="cm">/** reset global iteration 			*/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="p">.</span><span class="n">status</span><span class="w"> 	   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">              						</span><span class="cm">/** reset status code 			*/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="p">.</span><span class="n">numPoint</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">sgleP</span><span class="p">;</span><span class="w"> 								</span><span class="cm">/** the number of the current point */</span><span class="w"></span>

<span class="w">		</span><span class="cm">/* If we read input from file: */</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="w"> </span><span class="n">File</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">						</span>
<span class="w">			</span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_data</span><span class="p">[</span><span class="n">sgleP</span><span class="p">].</span><span class="n">P</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_data</span><span class="p">[</span><span class="n">sgleP</span><span class="p">].</span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">273.15</span><span class="p">;</span><span class="w">					</span><span class="cm">/** K to C 									*/</span><span class="w"></span>

<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">gv</span><span class="p">.</span><span class="n">gam_tot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_data</span><span class="p">[</span><span class="n">sgleP</span><span class="p">].</span><span class="n">in_gam</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">					</span>
<span class="w">			</span><span class="p">}</span><span class="w">		</span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span>
<span class="w">		</span><span class="cm">/* reset global variables flags 		*/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reset_gv</span><span class="p">(</span><span class="w">						</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="w">				</span><span class="p">);</span><span class="w"></span>
<span class="w">											</span>
<span class="w">		</span><span class="cm">/** reset considered phases structure 	*/</span><span class="w"></span>
<span class="w">		</span><span class="n">reset_cp</span><span class="p">(</span><span class="w">							</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w">						</span><span class="p">);</span><span class="w">	</span>
<span class="w">											</span>
<span class="w">		</span><span class="cm">/** reset pure and solution phases		*/</span><span class="w"></span>
<span class="w">		</span><span class="n">reset_SS</span><span class="p">(</span><span class="w">							</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="w">				</span><span class="p">);</span><span class="w">	</span>
<span class="w">		</span>
<span class="w">		</span><span class="cm">/** reset stable phases					*/</span><span class="w"></span>
<span class="w">		</span><span class="n">reset_sp</span><span class="p">(</span><span class="w">							</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">sp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span>
<span class="w">		</span><span class="cm">/* Perform calculation for a single point */</span><span class="w">	</span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComputeEquilibrium_Point</span><span class="p">(</span><span class="w">		</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span>
<span class="w">											</span><span class="n">input_data</span><span class="p">[</span><span class="n">sgleP</span><span class="p">],</span><span class="w"></span>
<span class="w">											</span><span class="n">Mode</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w">											</span><span class="cm">/** bulk rock informations 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span><span class="cm">/** global variables (e.g. Gamma) 	*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** pure phase database 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** solid solution database 		*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="cm">/* Perform calculation for a single point */</span><span class="w">	</span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComputePostProcessing</span><span class="p">(</span><span class="w">			</span><span class="n">EM_database</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w">											</span><span class="cm">/** bulk rock informations 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span><span class="cm">/** global variables (e.g. Gamma) 	*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** pure phase database 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** solid solution database 		*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span>
<span class="w">		</span><span class="cm">/* Fill structure holding stable phase equilibrium informations */</span><span class="w"></span>
<span class="w">		</span><span class="n">fill_output_struct</span><span class="p">(</span><span class="w">					</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span><span class="cm">/** global variables (e.g. Gamma) 	*/</span><span class="w"></span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w">											</span><span class="cm">/** bulk-rock informations 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** pure phase database 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** solution phase database 		*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">sp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="cm">/* Dump final results to files */</span><span class="w"></span>
<span class="w">		</span><span class="n">dump_results_function</span><span class="p">(</span><span class="w">				</span><span class="n">gv</span><span class="p">,</span><span class="w">												</span><span class="cm">/** global variables (e.g. Gamma) 	*/</span><span class="w"></span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w">											</span><span class="cm">/** bulk-rock informations 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** pure phase database 			*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">									</span><span class="cm">/** solution phase database 		*/</span><span class="w"></span>
<span class="w">											</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="cm">/* Print output to screen */</span><span class="w"></span>
<span class="w">		</span><span class="n">t</span><span class="w"> 			</span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"> </span>
<span class="w">		</span><span class="n">time_taken</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">CLOCKS_PER_SEC</span><span class="p">;</span><span class="w"> 											</span><span class="cm">/* in seconds 	 					*/</span><span class="w"></span>
<span class="w">		</span><span class="n">PrintOutput</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">sgleP</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="p">,</span><span class="w"> </span><span class="n">time_taken</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">);</span><span class="w">									</span><span class="cm">/* print output on screen 			*/</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* end of loop over points */</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* wait for all cores to be finished */</span><span class="w"></span>
<span class="w">	</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">);</span><span class="w">		</span>

<span class="w">	</span><span class="cm">/* now merge the parallel output files into one*/</span><span class="w"></span>
<span class="w">	</span><span class="n">mergeParallelFiles</span><span class="p">(</span><span class="n">gv</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* free memory allocated to solution and pure phases */</span><span class="w"></span>
<span class="w">	</span><span class="n">FreeDatabases</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* print the time */</span><span class="w"></span>
<span class="w">	</span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">;</span><span class="w"> </span>
<span class="w">	</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">time_taken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">CLOCKS_PER_SEC</span><span class="p">);</span><span class="w"> 				</span><span class="cm">/** in seconds */</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rank</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;__________________________________</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MAGEMin comp time: %+3f ms }</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time_taken</span><span class="o">*</span><span class="mf">1000.</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.ComputePostProcessing"><span class="cm">/** </span>
<span class="cm">  Compute stable equilibrium at given P/T/C point</span>
<span class="cm">*/</span><span class="w"></span>
<span class="w">	</span><span class="n">global_variable</span><span class="w"> </span><span class="nf">ComputePostProcessing</span><span class="p">(</span><span class="w">			</span><span class="kt">int</span><span class="w"> 				 </span><span class="n">EM_database</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="k">struct</span> <span class="nc">bulk_info</span><span class="w"> 	 </span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">global_variable</span><span class="w"> 	 </span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">PP_ref</span><span class="w">  			</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">SS_ref</span><span class="w">  			</span><span class="o">*</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">csd_phase_set</span><span class="w">  		</span><span class="o">*</span><span class="n">cp</span><span class="w">					</span><span class="p">){</span><span class="w"></span>
<span class="w">								</span>
<span class="w">	</span><span class="n">PP_ref</span><span class="w"> </span><span class="n">PP_db</span><span class="p">;</span><span class="w">					</span>
<span class="w">								</span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">muC</span><span class="p">,</span><span class="w"> </span><span class="n">muN</span><span class="p">,</span><span class="w"> </span><span class="n">muE</span><span class="p">,</span><span class="w"> </span><span class="n">muW</span><span class="p">,</span><span class="w"> </span><span class="n">muNN</span><span class="p">,</span><span class="w"> </span><span class="n">muNE</span><span class="p">,</span><span class="w"> </span><span class="n">muNW</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">P</span><span class="w"> 			  </span><span class="o">=</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="p">;</span><span class="w">					</span><span class="cm">/** PC function uses the z_b structure this is why the Pressure is saved here */</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">T</span><span class="w"> 			  </span><span class="o">=</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="p">;</span><span class="w">					</span><span class="cm">/** PC function uses the z_b structure this is why the Pressure is saved here */</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">sum_volume</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">dGdTPP</span><span class="p">,</span><span class="w"> </span><span class="n">dGdTMP</span><span class="p">,</span><span class="w"> </span><span class="n">dG2dT2</span><span class="p">,</span><span class="w"> </span><span class="n">dGdP</span><span class="p">,</span><span class="w"> </span><span class="n">dG2dP2</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">density</span><span class="p">[</span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">];</span><span class="w"></span>

<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="cm">/** calculate mass, volume and densities */</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_cp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">;</span><span class="w">	</span>
<span class="w">			</span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">iguess</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xeos</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/* Associate the right solid-solution data */</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">FD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">FD</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="n">FD</span><span class="o">++</span><span class="p">){</span><span class="w"></span>

<span class="w">				</span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> 		</span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">numDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">FD</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> 		</span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">numDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">FD</span><span class="p">];</span><span class="w"></span>
<span class="w">						</span>
<span class="w">				</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw_hyperplane</span><span class="p">(</span><span class="w">		</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span>
<span class="w">													</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span><span class="w"></span>
<span class="w">													</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="n">FD</span><span class="p">]</span><span class="w">	</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span>
<span class="w">				</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC_function</span><span class="p">(</span><span class="w">		</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span><span class="w"> </span>
<span class="w">													</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">													</span><span class="n">gv</span><span class="p">.</span><span class="n">SS_list</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> 				</span><span class="p">);</span><span class="w"></span>
<span class="w">													</span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_em</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"> </span>
<span class="w">					</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="n">FD</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w">		</span>
<span class="w">													</span>
<span class="w">			</span><span class="cm">/** calculate Molar Mass of solution phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="w">	</span><span class="o">+=</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_comp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">z_b</span><span class="p">.</span><span class="n">masspo</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="cm">/** calculate cp of solution phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_cp</span><span class="w"> 	 		 </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="w"> 	 		 </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_expansivity</span><span class="w">	 </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">n_em</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"> </span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">z_em</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1.0</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">dG2dT2</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="mf">-2.0</span><span class="o">*</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">dG2dP2</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="mf">-2.0</span><span class="o">*</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">dGdTPP</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">dGdTMP</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">dGdP</span><span class="w">					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu_array</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="cm">/* heat capacity 	*/</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_cp</span><span class="w">    		</span><span class="o">+=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="o">*</span><span class="p">(</span><span class="n">dG2dT2</span><span class="p">)</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">					</span>
<span class="w">					</span><span class="cm">/* volume 			*/</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="w">    		</span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">dGdP</span><span class="p">)</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">					</span>
<span class="w">					</span><span class="cm">/* expansivity 		*/</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_expansivity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">dGdP</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">dGdTPP</span><span class="o">-</span><span class="n">dGdTMP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">)))</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">					</span>
<span class="w">					</span><span class="cm">/* bulk modulus	*/</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">-</span><span class="n">dGdP</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">dG2dP2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(((</span><span class="n">dGdTPP</span><span class="o">-</span><span class="n">dGdTMP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">)),</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">dG2dT2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">					</span>
<span class="w">					</span><span class="cm">/* shear modulus	*/</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">ElShearMod</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w">	</span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/** calculate density from volume */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="o">*</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="cm">/** get sum of volume*fraction*factor to calculate vol% from mol% */</span><span class="w"></span>
<span class="w">			</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_pp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>

<span class="w">		</span><span class="cm">/* if pure phase is active or on hold (PP cannot be removed from consideration */</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_flags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>

<span class="w">			</span><span class="cm">/* calculate phase volume as V = dG/dP */</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">muC</span><span class="w">	 	 	 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">muN</span><span class="w"> 	 	 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="o">*</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">muNN</span><span class="w"> 	 	 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">muE</span><span class="w">	 		 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w">			</span>
<span class="w">			</span><span class="n">muW</span><span class="w">	 		 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">muNE</span><span class="w">	 	 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_db</span><span class="w">    	 </span><span class="o">=</span><span class="w"> </span><span class="n">G_EM_function</span><span class="p">(</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">bulk_rock</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;equilibrium&quot;</span><span class="p">);</span><span class="w">			</span>
<span class="w">			</span><span class="n">muNW</span><span class="w">	 	 </span><span class="o">=</span><span class="w"> </span><span class="n">PP_db</span><span class="p">.</span><span class="n">gbase</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="cm">/* Calculate mass per pure phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="w"> </span><span class="n">nEl</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">z_b</span><span class="p">.</span><span class="n">masspo</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="n">dG2dT2</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">muE</span><span class="mf">-2.0</span><span class="o">*</span><span class="n">muC</span><span class="o">+</span><span class="n">muW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">dG2dP2</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">muNN</span><span class="mf">-2.0</span><span class="o">*</span><span class="n">muN</span><span class="o">+</span><span class="n">muC</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">dGdTPP</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">muNE</span><span class="o">-</span><span class="n">muNW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">dGdTMP</span><span class="w"> 					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">muE</span><span class="o">-</span><span class="n">muW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_T_eps</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">dGdP</span><span class="w">					 </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">muN</span><span class="o">-</span><span class="n">muC</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="cm">/* Calculate volume  per pure phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="w">  	   		</span><span class="o">=</span><span class="w"> </span><span class="n">dGdP</span><span class="p">;</span><span class="w"> </span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/* Calculate density per pure phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_density</span><span class="w"> 		</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mass</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/* calculate cp of pure phase */</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_cp</span><span class="w"> 			</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="o">*</span><span class="p">(</span><span class="n">dG2dT2</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/* expansivity 		*/</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_expansivity</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">dGdP</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">dGdTPP</span><span class="o">-</span><span class="n">dGdTMP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="cm">/* shear modulus	*/</span><span class="w"></span>
<span class="w">			</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w">	</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">dGdP</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">dG2dP2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(((</span><span class="n">dGdTPP</span><span class="o">-</span><span class="n">dGdTMP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">gb_P_eps</span><span class="p">)),</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">dG2dT2</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">			</span><span class="cm">/** get sum of volume*fraction*factor to calculate vol% from mol% */</span><span class="w"></span>
<span class="w">			</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* calculate the bulk and shear modulus of the aggregate using the Voigt-Reuss-Hill averaging scheme with a weighting factor of 0.5 */</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_cp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">s1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">s2</span><span class="w"> </span><span class="o">+=</span><span class="w"> 	   </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">b1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w"> </span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">b2</span><span class="w"> </span><span class="o">+=</span><span class="w"> 	   </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w"> </span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_pp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_flags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">s1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">s2</span><span class="w"> </span><span class="o">+=</span><span class="w"> 	   </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_shearModulus</span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">b1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w"> </span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">b2</span><span class="w"> </span><span class="o">+=</span><span class="w">      </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_bulkModulus</span><span class="w"> </span><span class="o">/</span><span class="mf">10.0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">system_shearModulus</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">s2</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">system_bulkModulus</span><span class="w">  	</span><span class="o">=</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">b2</span><span class="p">));</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* calculate density of the system */</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_cp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">system_density</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_density</span><span class="o">*</span><span class="p">((</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="o">*</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="p">)</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_pp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_flags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">system_density</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phase_density</span><span class="o">*</span><span class="p">((</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">volume</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">factor</span><span class="p">)</span><span class="o">/</span><span class="n">sum_volume</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">system_Vp</span><span class="w"> 			</span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">system_bulkModulus</span><span class="w"> </span><span class="o">+</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span><span class="o">*</span><span class="n">gv</span><span class="p">.</span><span class="n">system_shearModulus</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">system_density</span><span class="o">/</span><span class="mf">1e3</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="p">.</span><span class="n">system_Vs</span><span class="w"> 			</span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">system_shearModulus</span><span class="o">/</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">system_density</span><span class="o">/</span><span class="mf">1e3</span><span class="p">));</span><span class="w"></span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;System information</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;═══════════════════</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Mass residual      : %+12.5f</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">BR_norm</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Volume             : %+12.5f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">sum_volume</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Density            : %+12.5f</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">system_density</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Shear modulus      : %+12.5f</span><span class="se">\t</span><span class="s"> [GPa]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">system_shearModulus</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Vp                 : %+12.5f</span><span class="se">\t</span><span class="s"> [km/s]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">system_Vp</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Vs                 : %+12.5f</span><span class="se">\t</span><span class="s"> [km/s]</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">system_Vs</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">gv</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.ComputeEquilibrium_Point"><span class="cm">/** </span>
<span class="cm">  Compute stable equilibrium at given P/T/C point</span>
<span class="cm">*/</span><span class="w"></span>
<span class="n">global_variable</span><span class="w"> </span><span class="nf">ComputeEquilibrium_Point</span><span class="p">(</span><span class="w"> 		</span><span class="kt">int</span><span class="w"> 				 </span><span class="n">EM_database</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="n">io_data</span><span class="w"> 			 </span><span class="n">input_data</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="kt">int</span><span class="w"> 				 </span><span class="n">Mode</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="k">struct</span> <span class="nc">bulk_info</span><span class="w"> 	 </span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="n">global_variable</span><span class="w"> 	 </span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="n">PP_ref</span><span class="w">  			</span><span class="o">*</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="n">SS_ref</span><span class="w">  			</span><span class="o">*</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w"></span>
<span class="w">												</span><span class="n">csd_phase_set</span><span class="w">  		</span><span class="o">*</span><span class="n">cp</span><span class="w">						</span><span class="p">){</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* initialize endmember database for given P-T point */</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_em_db</span><span class="p">(</span><span class="w">		</span><span class="n">EM_database</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">z_b</span><span class="p">,</span><span class="w">										</span><span class="cm">/** bulk rock informations */</span><span class="w"></span>
<span class="w">							</span><span class="n">gv</span><span class="p">,</span><span class="w">											</span><span class="cm">/** global variables (e.g. Gamma) */</span><span class="w"></span>
<span class="w">							</span><span class="n">PP_ref_db</span><span class="w">				</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Calculate solution phase data at given P-T conditions (G0 based on G0 of endmembers) */</span><span class="w"></span>
<span class="w">	</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_ss_db</span><span class="p">(</span><span class="w">		</span><span class="n">EM_database</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">SS_ref_db</span><span class="w">						</span><span class="p">);</span><span class="w"></span>


<span class="w">	</span><span class="cm">/* if Mode is 0, perform normal minimization with PGE */</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">		</span><span class="cm">/**                                   LEVELLING                                        **/</span><span class="w"></span>
<span class="w">		</span><span class="cm">/****************************************************************************************/</span><span class="w">	</span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Levelling</span><span class="p">(</span><span class="w">			</span><span class="n">z_b</span><span class="p">,</span><span class="w">									</span><span class="cm">/** bulk rock informations */</span><span class="w"></span>
<span class="w">								</span><span class="n">gv</span><span class="p">,</span><span class="w">										</span><span class="cm">/** global variables (e.g. Gamma) */</span><span class="w"></span>
<span class="w">								</span>
<span class="w">								</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** pure phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** solution phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">cp</span><span class="w">					</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span>
<span class="w">		</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">		</span><span class="cm">/**                                   MAIN LOOP (PGE)                                  **/</span><span class="w"></span>
<span class="w">		</span><span class="cm">/****************************************************************************************/</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PGE</span><span class="p">(</span><span class="w">				</span><span class="n">z_b</span><span class="p">,</span><span class="w">									</span><span class="cm">/** bulk rock constraint */</span><span class="w"> </span>
<span class="w">								</span><span class="n">gv</span><span class="p">,</span><span class="w">										</span><span class="cm">/** global variables (e.g. Gamma) */</span><span class="w"></span>
<span class="w">								</span>
<span class="w">								</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** pure phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** solution phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">cp</span><span class="w">					</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* if Mode = 1, spit out Gibbs energy and reference values with given compositional variables */</span><span class="w"></span>
<span class="w">	</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Spit out Solution model informations for given input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  ════════════════════════════════════════════════════</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">id_cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">input_data</span><span class="p">.</span><span class="n">n_phase</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="cm">/* simple function to get the array index of the given solution phase */</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_phase_id</span><span class="p">(</span><span class="w">		</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">										</span><span class="n">input_data</span><span class="p">.</span><span class="n">phase_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">	</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">iguess</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">input_data</span><span class="p">.</span><span class="n">phase_xeos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw_hyperplane</span><span class="p">(</span><span class="w">		</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span>
<span class="w">												</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span><span class="w"></span>
<span class="w">												</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">gbase</span><span class="w">		</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PC_function</span><span class="p">(</span><span class="w">	</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span><span class="w"> </span>
<span class="w">											</span><span class="n">z_b</span><span class="p">,</span><span class="w"></span>
<span class="w">											</span><span class="n">gv</span><span class="p">.</span><span class="n">SS_list</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> 				</span><span class="p">);</span><span class="w"></span>
<span class="w">											</span>
<span class="w">			</span><span class="n">strcpy</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">SS_list</span><span class="p">[</span><span class="n">ss</span><span class="p">]);</span><span class="w">				</span><span class="cm">/* get phase name */</span><span class="w">	</span>
<span class="w">			</span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">split</span><span class="w"> 		</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">							</span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">id</span><span class="w"> 			</span><span class="o">=</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w">						</span><span class="cm">/* get phase id */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_xeos</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w">		</span><span class="cm">/* get number of compositional variables */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_em</span><span class="w">			</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_em</span><span class="p">;</span><span class="w">		</span><span class="cm">/* get number of endmembers */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_sf</span><span class="w">			</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_sf</span><span class="p">;</span><span class="w">		</span><span class="cm">/* get number of site fractions */</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">df</span><span class="w">			</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">df_raw</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">factor</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">factor</span><span class="p">;</span><span class="w">	</span>
<span class="w">			</span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">							</span><span class="cm">/* set flags */</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> 	</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">ss_n</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">			</span><span class="cm">/* get initial phase fraction */</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">xeos</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">iguess</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"> </span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">dfx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">dfx</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"> </span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_em</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">p_em</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">xi_em</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">xi_em</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">mu</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">mu</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">gbase</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">gbase</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_em</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">dpdx</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">dp_dx</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">];</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_ox</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">ss_comp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">	</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">ss_comp</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">n_sf</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">cp</span><span class="p">[</span><span class="n">id_cp</span><span class="p">].</span><span class="n">sf</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w">		</span><span class="o">=</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">sf</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w">	</span>
<span class="w">			</span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">id_solvi</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">gv</span><span class="p">.</span><span class="n">n_solvi</span><span class="p">[</span><span class="n">ss</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id_cp</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">n_solvi</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="w"> 	   	   </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">id_cp</span><span class="w"> 				   </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">len_cp</span><span class="w"> 			   </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">n_cp_phase</span><span class="w"> 		   </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">gv</span><span class="p">.</span><span class="n">n_phase</span><span class="w">             </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">==</span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;   -&gt; reading in %4s %+10f|&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">SS_list</span><span class="p">[</span><span class="n">ss</span><span class="p">],</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">df</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">ss</span><span class="p">].</span><span class="n">n_xeos</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; %+12.5f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">input_data</span><span class="p">.</span><span class="n">phase_xeos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* if Mode = 2, perform search of local minima for given solution phase */</span><span class="w"></span>
<span class="w">	</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;function has been deleted</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="cm">/* if Mode = 3, perform first stage levelling only */</span><span class="w"></span>
<span class="w">	</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="cm">/* when Mode = 3, only first stage of levelling is activated */</span><span class="w"></span>
<span class="w">		</span><span class="n">gv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Levelling</span><span class="p">(</span><span class="w">			</span><span class="n">z_b</span><span class="p">,</span><span class="w">									</span><span class="cm">/** bulk rock informations */</span><span class="w"></span>
<span class="w">								</span><span class="n">gv</span><span class="p">,</span><span class="w">										</span><span class="cm">/** global variables (e.g. Gamma) */</span><span class="w"></span>
<span class="w">								</span>
<span class="w">								</span><span class="n">PP_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** pure phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">SS_ref_db</span><span class="p">,</span><span class="w">								</span><span class="cm">/** solution phase database */</span><span class="w"></span>
<span class="w">								</span><span class="n">cp</span><span class="w">						</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">gv</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.ReadCommandLineOptions"><span class="cm">/** </span>
<span class="cm">  Get command line options</span>
<span class="cm">*/</span><span class="w"></span>
<span class="n">global_variable</span><span class="w"> </span><span class="nf">ReadCommandLineOptions</span><span class="p">(</span><span class="w">	</span><span class="n">global_variable</span><span class="w"> 	 </span><span class="n">gv</span><span class="p">,</span><span class="w">		</span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				 </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">char</span><span class="w"> 			   </span><span class="o">**</span><span class="n">argv</span><span class="p">,</span><span class="w"> 	</span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">Mode_out</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">Verb_out</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">test_out</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">n_points_out</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">double</span><span class="w"> 				</span><span class="o">*</span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">double</span><span class="w"> 				</span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="w"> </span>
<span class="w">										</span><span class="kt">double</span><span class="w"> 				 </span><span class="n">Bulk</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span><span class="w"> </span>
<span class="w">										</span><span class="kt">double</span><span class="w"> 				 </span><span class="n">Gam</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span><span class="w"> </span>
<span class="w">										</span><span class="kt">double</span><span class="w"> 				 </span><span class="n">InitEM_Prop</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span><span class="w"></span>
<span class="w">										</span><span class="kt">char</span><span class="w"> 				 </span><span class="n">File</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span><span class="w"> </span>
<span class="w">										</span><span class="kt">char</span><span class="w"> 				 </span><span class="n">Phase</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span><span class="w"> </span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">maxeval_out</span><span class="p">,</span><span class="w"></span>
<span class="w">										</span><span class="kt">int</span><span class="w"> 				</span><span class="o">*</span><span class="n">get_version_out</span><span class="w">			</span>
<span class="p">){</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">static</span><span class="w"> </span><span class="n">ko_longopt_t</span><span class="w"> </span><span class="n">longopts</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Verb&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">301</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Mode&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">302</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;File&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">303</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;n_points &quot;</span><span class="p">,</span><span class="w">	</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">304</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w">  		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">305</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Temp&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">306</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Pres&quot;</span><span class="p">,</span><span class="w">  		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">307</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Phase&quot;</span><span class="p">,</span><span class="w">  	</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">308</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;n_pc&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">309</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Gam&quot;</span><span class="p">,</span><span class="w">  		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">310</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Bulk&quot;</span><span class="p">,</span><span class="w"> 		</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">311</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;InitEM_Prop&quot;</span><span class="p">,</span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">312</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;maxeval&quot;</span><span class="p">,</span><span class="w">    </span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">313</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="w">    </span><span class="n">ko_optional_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">314</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    	</span><span class="p">{</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">};</span><span class="w"></span>
<span class="w">	</span><span class="n">ketopt_t</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KETOPT_INIT</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">Mode</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">Verb</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">test</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">n_points</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">n_pc</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">2</span><span class="p">;</span><span class="w">		</span><span class="cm">/** number of pseudocompounds for Mode 2 */</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w">    </span><span class="n">maxeval</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kt">double</span><span class="w"> </span><span class="n">Temp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Pres</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">Temp</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1100.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">Pres</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">12.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	 </span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nEl</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Bulk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">Gam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">InitEM_Prop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-100.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">strcpy</span><span class="p">(</span><span class="n">File</span><span class="p">,</span><span class="s">&quot;none&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Filename to be read to have multiple P-T-bulk conditions to solve</span>

<span class="w">	</span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ketopt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">longopts</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> 		</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">314</span><span class="p">){</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MAGEMin %20s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w">	</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w">	</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">301</span><span class="p">){</span><span class="w"> </span><span class="n">Verb</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="w">	</span><span class="p">);}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">302</span><span class="p">){</span><span class="w"> </span><span class="n">Mode</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Mode        : Mode                     = %i </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 	 	   		</span><span class="n">Mode</span><span class="w">		</span><span class="p">);}}</span><span class="w">																		</span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">303</span><span class="p">){</span><span class="w"> </span><span class="n">strcpy</span><span class="p">(</span><span class="n">File</span><span class="p">,</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span><span class="w">		 		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--File        : File                     = %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 	 	   		</span><span class="n">File</span><span class="w">		</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">304</span><span class="p">){</span><span class="w"> </span><span class="n">n_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span><span class="w"> 	 		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--n_points    : n_points                 = %i </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 	 	   		</span><span class="n">n_points</span><span class="w">	</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">305</span><span class="p">){</span><span class="w"> </span><span class="n">test</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span><span class="w"> 		 	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--test        : Test                     = %i </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 	 	  		</span><span class="n">test</span><span class="w">		</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">306</span><span class="p">){</span><span class="w"> </span><span class="n">Temp</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">strtof</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span><span class="w"> 	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Temp        : Temperature              = %f C </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w">             </span><span class="n">Temp</span><span class="w">		</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">307</span><span class="p">){</span><span class="w"> </span><span class="n">Pres</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">strtof</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span><span class="w"> 	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Pres        : Pressure                 = %f kbar </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 			</span><span class="n">Pres</span><span class="w">		</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">308</span><span class="p">){</span><span class="w"> </span><span class="n">strcpy</span><span class="p">(</span><span class="n">Phase</span><span class="p">,</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span><span class="w">		 		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Phase       : Phase name               = %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> 	   			</span><span class="n">Phase</span><span class="w">		</span><span class="p">);}}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">313</span><span class="p">){</span><span class="w"> </span><span class="n">maxeval</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">strtof</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span><span class="w"> 	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxeval</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--maxeval     : Max. # of local iter.    = infinite  </span><span class="se">\n</span><span class="s">&quot;</span><span class="w">		</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="p">{</span><span class="w">                   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--maxeval     : Max. # of local iter.    = %i  </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">maxeval</span><span class="w">		</span><span class="p">);}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">310</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">Gam</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Gam  	      : Gamma           = &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Gam</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span><span class="w">	</span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; dG </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		 </span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">311</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">Bulk</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--Bulk  	 : Bulk         = &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Bulk</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span><span class="w">	</span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		 </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">312</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">arg</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">InitEM_Prop</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="n">num</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Verb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;--InitEM_Prop : Initial EM prop = &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">					</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">InitEM_Prop</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span><span class="w">	</span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		 </span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Output */</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">Verb_out</span><span class="w"> 		</span><span class="o">=</span><span class="w"> 	</span><span class="n">Verb</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">Mode_out</span><span class="w"> 		</span><span class="o">=</span><span class="w"> 	</span><span class="n">Mode</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">test_out</span><span class="w">	 	</span><span class="o">=</span><span class="w"> 	</span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">P</span><span class="w">        		</span><span class="o">=</span><span class="w"> 	</span><span class="n">Pres</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">T</span><span class="w">        		</span><span class="o">=</span><span class="w"> 	</span><span class="n">Temp</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="o">*</span><span class="n">n_points_out</span><span class="w"> 	</span><span class="o">=</span><span class="w"> 	</span><span class="n">n_points</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">maxeval_out</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="n">maxeval</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">gv</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span></div>

<span class="w">	</span>
<div class="viewcode-block" id="c.InitializeDatabases"><span class="cm">/** </span>
<span class="cm">  Initiatizes the endmember and solid solution databases and adds them to a single struct</span>
<span class="cm">**/</span><span class="w"></span>
<span class="n">Databases</span><span class="w"> </span><span class="nf">InitializeDatabases</span><span class="p">(</span><span class="w">	</span><span class="n">global_variable</span><span class="w"> </span><span class="n">gv</span><span class="p">,</span><span class="w"> </span>
<span class="w">								</span><span class="kt">int</span><span class="w"> 			</span><span class="n">EM_database</span><span class="w"></span>
<span class="p">){</span><span class="w"></span>
<span class="w">	</span><span class="n">Databases</span><span class="w"> 	</span><span class="n">DB</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> 		</span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Allocate pure-phase database (to get gbase, comp and factor) 				*/</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="w"> </span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">len_pp</span><span class="p">)</span><span class="w"> 		</span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">PP_ref</span><span class="p">));</span><span class="w"> </span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Allocate solid-solution reference database (to get gbase, comp and factor) 	*/</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="w"> </span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">len_ss</span><span class="p">)</span><span class="w"> 		</span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">SS_ref</span><span class="p">));</span><span class="w"> </span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Allocate memory of the considered set of phases 								*/</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w"> 		 </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="w"> </span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">max_n_cp</span><span class="p">)</span><span class="w"> 	</span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">csd_phase_set</span><span class="p">));</span><span class="w"> </span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Allocate memory of the considered set of phases 								*/</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">sp</span><span class="w"> 		 </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> 	</span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">stb_system</span><span class="p">));</span><span class="w"> </span>

<span class="w">	</span><span class="cm">/* Allocate memory for each solution phase according to their specificities (n_em, sf etc) */</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_ss</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G_SS_INIT_EM_function</span><span class="p">(</span><span class="w">		</span><span class="n">DB</span><span class="p">.</span><span class="n">SS_ref_db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">														</span><span class="n">EM_database</span><span class="p">,</span><span class="w"> </span>
<span class="w">														</span><span class="n">gv</span><span class="p">.</span><span class="n">SS_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">														</span><span class="n">gv</span><span class="w">						</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Allocate memory of the considered set of phases 								*/</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">max_n_cp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CP_INIT_function</span><span class="p">(</span><span class="w">		</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">											</span><span class="n">gv</span><span class="w">									</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="cm">/* Allocate memory for the stable phase equilibrium 							*/</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SP_INIT_function</span><span class="p">(</span><span class="w">		</span><span class="n">DB</span><span class="p">.</span><span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">gv</span><span class="w">							</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Endmember names */</span><span class="w"></span>
<span class="w">	</span><span class="n">DB</span><span class="p">.</span><span class="n">EM_names</span><span class="w">  </span><span class="o">=</span><span class="w">	</span><span class="n">get_EM_DB_names</span><span class="p">(</span><span class="n">EM_database</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Create endmember Hashtable */</span><span class="w"></span>
<span class="w">	</span><span class="k">struct</span> <span class="nc">EM2id</span><span class="w"> </span><span class="o">*</span><span class="n">p_s</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">tmp_p</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">struct</span> <span class="nc">EM_db</span><span class="w"> </span><span class="n">EM_return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_em_db</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">char</span><span class="w"> </span><span class="n">EM_name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">p_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span> <span class="nc">EM2id</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="w"> </span><span class="o">*</span><span class="n">p_s</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">p_s</span><span class="o">-&gt;</span><span class="n">EM_tag</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="p">.</span><span class="n">EM_names</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">p_s</span><span class="o">-&gt;</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">HASH_ADD_STR</span><span class="p">(</span><span class="w"> </span><span class="n">EM</span><span class="p">,</span><span class="w"> </span><span class="n">EM_tag</span><span class="p">,</span><span class="w"> </span><span class="n">p_s</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/* Create pure-phase hashtable */</span><span class="w"></span>
<span class="w">	</span><span class="k">struct</span> <span class="nc">PP2id</span><span class="w"> </span><span class="o">*</span><span class="n">pp_s</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">tmp_pp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">pp_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span> <span class="nc">PP2id</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="w"> </span><span class="o">*</span><span class="n">pp_s</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">pp_s</span><span class="o">-&gt;</span><span class="n">PP_tag</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">pp_s</span><span class="o">-&gt;</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">HASH_ADD_STR</span><span class="p">(</span><span class="w"> </span><span class="n">PP</span><span class="p">,</span><span class="w"> </span><span class="n">PP_tag</span><span class="p">,</span><span class="w"> </span><span class="n">pp_s</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">DB</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.FreeDatabases"><span class="cm">/** </span>
<span class="cm">  Free the memory associated with the databases</span>
<span class="cm">**/</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FreeDatabases</span><span class="p">(</span><span class="w">		</span><span class="n">global_variable</span><span class="w"> </span><span class="n">gv</span><span class="p">,</span><span class="w"> </span>
<span class="w">						</span><span class="n">Databases</span><span class="w"> 		</span><span class="n">DB</span><span class="w">	</span><span class="p">){</span><span class="w"></span>

<span class="w">	</span><span class="n">CP_destroy</span><span class="p">(</span><span class="w">			</span><span class="n">gv</span><span class="p">,</span><span class="w"> </span>
<span class="w">						</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="w">				</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">free</span><span class="p">(</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_em_db</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">free</span><span class="p">(</span><span class="n">DB</span><span class="p">.</span><span class="n">EM_names</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="n">free</span><span class="p">(</span><span class="n">DB</span><span class="p">.</span><span class="n">EM_names</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">free</span><span class="p">(</span><span class="n">DB</span><span class="p">.</span><span class="n">PP_ref_db</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.PrintOutput"><span class="cm">/** </span>
<span class="cm">  This prints output on screen</span>
<span class="cm">**/</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">PrintOutput</span><span class="p">(</span><span class="w">	</span><span class="n">global_variable</span><span class="w"> 	</span><span class="n">gv</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> 				</span><span class="n">rank</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> 				</span><span class="n">l</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">Databases</span><span class="w"> 			</span><span class="n">DB</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="kt">double</span><span class="w"> 				</span><span class="n">time_taken</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="k">struct</span> <span class="nc">bulk_info</span><span class="w"> 	</span><span class="n">z_b</span><span class="w">				</span><span class="p">){</span><span class="w"></span>
<span class="w">						</span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">Mode</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">!=</span><span class="mi">-1</span><span class="p">){</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Status             : %i &quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">status</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="n">PrintStatus</span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">status</span><span class="p">);}</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>


<span class="w">    	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Rank               : %12i </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">rank</span><span class="p">);</span><span class="w"></span>
<span class="w">    	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Point              : %12i </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">l</span><span class="p">);</span><span class="w"></span>
<span class="w">    	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Temperature        : %+12.5f</span><span class="se">\t</span><span class="s"> [C] </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w">   </span><span class="n">z_b</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">273.15</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Pressure           : %+12.5f</span><span class="se">\t</span><span class="s"> [kbar]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">P</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span>
<span class="w"> 		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w"> 			</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">______________________________</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;| Total Time: %.6f (ms) |&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time_taken</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">══════════════════════════════</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">gv</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">  </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">Mode</span><span class="o">==</span><span class="mi">0</span><span class="p">)){</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">SOLUTION: [G = %.3f] (%i iterations, %.2f ms)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">G_system</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">global_ite</span><span class="p">,</span><span class="n">time_taken</span><span class="o">*</span><span class="mf">1000.0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;[&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">z_b</span><span class="p">.</span><span class="n">nzEl_val</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%+8f,&quot;</span><span class="p">,</span><span class="n">gv</span><span class="p">.</span><span class="n">gam_tot</span><span class="p">[</span><span class="n">z_b</span><span class="p">.</span><span class="n">nzEl_array</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_cp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4s </span><span class="se">\t</span><span class="s"> %.5f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">DB</span><span class="p">.</span><span class="n">cp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ss_n</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">len_pp</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gv</span><span class="p">.</span><span class="n">pp_flags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<span class="w">				</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4s </span><span class="se">\t</span><span class="s"> %.5f </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">PP_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">gv</span><span class="p">.</span><span class="n">pp_n</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w">	</span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>

<div class="viewcode-block" id="c.PrintStatus"><span class="cm">/** </span>
<span class="cm">  This converts the solver status code to human-readable text and prints it to screen</span>
<span class="cm">**/</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">PrintStatus</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(success)&quot;</span><span class="p">);}</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(success, under-relaxed)&quot;</span><span class="p">);}</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(success, heavily under-relaxed)&quot;</span><span class="p">);}</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(failure, reached maximum iterations)&quot;</span><span class="p">);}</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;(failure, terminated due to slow convergence or divergence)&quot;</span><span class="p">);}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Riel, N., &amp; Kaus, B.J.P..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>